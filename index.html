<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QuizMaster - –°–æ–∑–¥–∞–≤–∞–π –∏ —Ä–µ—à–∞–π</title>
    <style>
        :root {
            --primary: #6366f1;
            --bg: #f3f4f6;
            --card: #ffffff;
            --text: #1f2937;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .container {
            max-width: 800px;
            width: 100%;
        }

        h1, h2 { text-align: center; color: var(--primary); }

        .card {
            background: var(--card);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .btn {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: 0.2s;
            margin: 5px;
        }

        .btn:hover { opacity: 0.9; }
        .btn-outline { background: transparent; border: 2px solid var(--primary); color: var(--primary); }
        .btn-danger { background-color: #ef4444; }

        input, select {
            width: 100%;
            padding: 10px;
            margin: 8px 0;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            box-sizing: border-box;
        }

        .hidden { display: none; }
        
        .option-group { display: flex; gap: 10px; align-items: center; }
        .quiz-item {
            border-bottom: 1px solid #eee;
            padding: 10px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è —Å–∞–º–æ–≥–æ —Ç–µ—Å—Ç–∞ */
        .question-text { font-size: 1.2rem; font-weight: bold; margin-bottom: 15px; }
        .options-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .option-btn {
            padding: 15px;
            background: #eef2ff;
            border: 2px solid transparent;
            border-radius: 8px;
            cursor: pointer;
            text-align: left;
        }
        .option-btn:hover { border-color: var(--primary); }
        .option-btn.correct { background-color: #d1fae5; border-color: #10b981; }
        .option-btn.wrong { background-color: #fee2e2; border-color: #ef4444; }

    </style>
</head>
<body>

<div class="container">
    <h1>üß† QuizMaster</h1>
    
    <div id="menu-screen" class="card">
        <h2>–ú–æ–∏ –∫–≤–∏–∑—ã</h2>
        <div style="display: flex; justify-content: center; gap: 10px; margin-bottom: 20px;">
            <button class="btn" onclick="showCreator()">+ –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π</button>
            <label class="btn btn-outline" style="cursor: pointer;">
                üì• –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª
                <input type="file" id="fileInput" accept=".json" hidden onchange="loadQuizFromFile(this)">
            </label>
        </div>
        <div id="quiz-list">
            <p style="text-align: center; color: #888;">–ü–æ–∫–∞ –Ω–µ—Ç —Ç–µ—Å—Ç–æ–≤. –°–æ–∑–¥–∞–π—Ç–µ –∏–ª–∏ –∑–∞–≥—Ä—É–∑–∏—Ç–µ!</p>
        </div>
    </div>

    <div id="creator-screen" class="card hidden">
        <h2>–°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–∞</h2>
        <input type="text" id="new-quiz-title" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–µ—Å—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: –ò—Å—Ç–æ—Ä–∏—è –†–∏–º–∞)">
        <hr>
        <div id="questions-container">
            <div class="question-form">
                <input type="text" id="q-text" placeholder="–¢–µ–∫—Å—Ç –≤–æ–ø—Ä–æ—Å–∞">
                <div class="option-group"><span>A)</span> <input type="text" id="opt-a" placeholder="–í–∞—Ä–∏–∞–Ω—Ç A"></div>
                <div class="option-group"><span>B)</span> <input type="text" id="opt-b" placeholder="–í–∞—Ä–∏–∞–Ω—Ç B"></div>
                <div class="option-group"><span>C)</span> <input type="text" id="opt-c" placeholder="–í–∞—Ä–∏–∞–Ω—Ç C"></div>
                <div class="option-group"><span>D)</span> <input type="text" id="opt-d" placeholder="–í–∞—Ä–∏–∞–Ω—Ç D"></div>
                <label>–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç:</label>
                <select id="correct-opt">
                    <option value="0">A</option>
                    <option value="1">B</option>
                    <option value="2">C</option>
                    <option value="3">D</option>
                </select>
                <button class="btn btn-outline" onclick="addQuestion()">–î–æ–±–∞–≤–∏—Ç—å –≤–æ–ø—Ä–æ—Å –≤ —Å–ø–∏—Å–æ–∫</button>
            </div>
        </div>
        
        <div style="margin-top: 20px; background: #f9fafb; padding: 10px; border-radius: 8px;">
            <strong>–î–æ–±–∞–≤–ª–µ–Ω–æ –≤–æ–ø—Ä–æ—Å–æ–≤: <span id="q-count">0</span></strong>
        </div>

        <div style="margin-top: 20px; display: flex; justify-content: space-between;">
            <button class="btn btn-danger" onclick="showMenu()">–û—Ç–º–µ–Ω–∞</button>
            <button class="btn" onclick="saveQuiz()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–µ—Å—Ç</button>
        </div>
    </div>

    <div id="game-screen" class="card hidden">
        <div style="display: flex; justify-content: space-between; margin-bottom: 20px;">
            <span id="quiz-title-display" style="font-weight: bold;"></span>
            <span id="score-display">–û—á–∫–∏: 0</span>
        </div>
        <div id="game-area">
            <div class="question-text" id="game-question"></div>
            <div class="options-grid" id="game-options"></div>
        </div>
        <button class="btn hidden" id="next-btn" onclick="nextQuestion()" style="width: 100%; margin-top: 20px;">–°–ª–µ–¥—É—é—â–∏–π –≤–æ–ø—Ä–æ—Å</button>
        <button class="btn btn-danger hidden" id="finish-btn" onclick="finishQuiz()" style="width: 100%; margin-top: 20px;">–ó–∞–≤–µ—Ä—à–∏—Ç—å</button>
    </div>
</div>

<script>
    // --- –õ–æ–≥–∏–∫–∞ –¥–∞–Ω–Ω—ã—Ö ---
    let quizzes = JSON.parse(localStorage.getItem('myQuizzes')) || [];
    let currentNewQuiz = { title: "", questions: [] };
    let activeQuiz = null;
    let currentQuestionIndex = 0;
    let score = 0;

    // --- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è ---
    renderQuizList();

    // --- –ù–∞–≤–∏–≥–∞—Ü–∏—è ---
    function showMenu() {
        document.getElementById('menu-screen').classList.remove('hidden');
        document.getElementById('creator-screen').classList.add('hidden');
        document.getElementById('game-screen').classList.add('hidden');
        renderQuizList();
    }

    function showCreator() {
        currentNewQuiz = { title: "", questions: [] };
        document.getElementById('q-count').innerText = '0';
        document.getElementById('new-quiz-title').value = '';
        document.getElementById('q-text').value = '';
        ['a','b','c','d'].forEach(l => document.getElementById(`opt-${l}`).value = '');
        
        document.getElementById('menu-screen').classList.add('hidden');
        document.getElementById('creator-screen').classList.remove('hidden');
    }

    // --- –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä ---
    function addQuestion() {
        const text = document.getElementById('q-text').value;
        const options = [
            document.getElementById('opt-a').value,
            document.getElementById('opt-b').value,
            document.getElementById('opt-c').value,
            document.getElementById('opt-d').value
        ];
        const correct = parseInt(document.getElementById('correct-opt').value);

        if(!text || options.some(o => !o)) {
            alert("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è!");
            return;
        }

        currentNewQuiz.questions.push({ text, options, correct });
        document.getElementById('q-count').innerText = currentNewQuiz.questions.length;
        
        // –û—á–∏—Å—Ç–∫–∞ –ø–æ–ª–µ–π
        document.getElementById('q-text').value = '';
        ['a','b','c','d'].forEach(l => document.getElementById(`opt-${l}`).value = '');
        alert("–í–æ–ø—Ä–æ—Å –¥–æ–±–∞–≤–ª–µ–Ω!");
    }

    function saveQuiz() {
        const title = document.getElementById('new-quiz-title').value;
        if(!title || currentNewQuiz.questions.length === 0) {
            alert("–£–∫–∞–∂–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏ –¥–æ–±–∞–≤—å—Ç–µ —Ö–æ—Ç—è –±—ã 1 –≤–æ–ø—Ä–æ—Å");
            return;
        }
        currentNewQuiz.title = title;
        currentNewQuiz.id = Date.now(); // –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID
        quizzes.push(currentNewQuiz);
        localStorage.setItem('myQuizzes', JSON.stringify(quizzes));
        showMenu();
    }

    // --- –°–ø–∏—Å–æ–∫ —Ç–µ—Å—Ç–æ–≤ ---
    function renderQuizList() {
        const list = document.getElementById('quiz-list');
        list.innerHTML = '';
        if(quizzes.length === 0) {
            list.innerHTML = '<p style="text-align: center; color: #888;">–°–ø–∏—Å–æ–∫ –ø—É—Å—Ç</p>';
            return;
        }

        quizzes.forEach((quiz, index) => {
            const div = document.createElement('div');
            div.className = 'quiz-item';
            div.innerHTML = `
                <div>
                    <strong>${quiz.title}</strong> (${quiz.questions.length} –≤–æ–ø—Ä.)
                </div>
                <div>
                    <button class="btn" onclick="startQuiz(${index})">‚ñ∂ –ù–∞—á–∞—Ç—å</button>
                    <button class="btn btn-outline" onclick="downloadQuiz(${index})">‚¨á –°–∫–∞—á–∞—Ç—å</button>
                    <button class="btn btn-danger" onclick="deleteQuiz(${index})">‚úñ</button>
                </div>
            `;
            list.appendChild(div);
        });
    }

    function deleteQuiz(index) {
        if(confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —Ç–µ—Å—Ç?')) {
            quizzes.splice(index, 1);
            localStorage.setItem('myQuizzes', JSON.stringify(quizzes));
            renderQuizList();
        }
    }

    // --- –ó–∞–≥—Ä—É–∑–∫–∞/–°–∫–∞—á–∏–≤–∞–Ω–∏–µ ---
    function downloadQuiz(index) {
        const quiz = quizzes[index];
        const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(quiz));
        const downloadAnchorNode = document.createElement('a');
        downloadAnchorNode.setAttribute("href", dataStr);
        downloadAnchorNode.setAttribute("download", quiz.title + ".json");
        document.body.appendChild(downloadAnchorNode);
        downloadAnchorNode.click();
        downloadAnchorNode.remove();
    }

    function loadQuizFromFile(input) {
        const file = input.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = function(e) {
            try {
                const quiz = JSON.parse(e.target.result);
                if(quiz.title && quiz.questions) {
                    quiz.id = Date.now();
                    quizzes.push(quiz);
                    localStorage.setItem('myQuizzes', JSON.stringify(quizzes));
                    renderQuizList();
                } else {
                    alert("–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞");
                }
            } catch (err) {
                alert("–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è JSON");
            }
        };
        reader.readAsText(file);
    }

    // --- –ò–≥—Ä–æ–≤–æ–π –ø—Ä–æ—Ü–µ—Å—Å ---
    function startQuiz(index) {
        activeQuiz = quizzes[index];
        currentQuestionIndex = 0;
        score = 0;
        document.getElementById('menu-screen').classList.add('hidden');
        document.getElementById('game-screen').classList.remove('hidden');
        document.getElementById('quiz-title-display').innerText = activeQuiz.title;
        renderQuestion();
    }

    function renderQuestion() {
        const q = activeQuiz.questions[currentQuestionIndex];
        document.getElementById('score-display').innerText = `–°—á–µ—Ç: ${score}/${activeQuiz.questions.length}`;
        document.getElementById('game-question').innerText = `${currentQuestionIndex + 1}. ${q.text}`;
        
        const optionsDiv = document.getElementById('game-options');
        optionsDiv.innerHTML = '';
        
        document.getElementById('next-btn').classList.add('hidden');
        document.getElementById('finish-btn').classList.add('hidden');

        q.options.forEach((opt, idx) => {
            const btn = document.createElement('button');
            btn.className = 'option-btn';
            btn.innerText = opt;
            btn.onclick = () => checkAnswer(idx, btn);
            optionsDiv.appendChild(btn);
        });
    }

    function checkAnswer(selectedIdx, btnElement) {
        const q = activeQuiz.questions[currentQuestionIndex];
        const allBtns = document.querySelectorAll('.option-btn');
        
        // –ë–ª–æ–∫–∏—Ä—É–µ–º –≤—Å–µ –∫–Ω–æ–ø–∫–∏
        allBtns.forEach(b => b.disabled = true);

        if(selectedIdx === q.correct) {
            btnElement.classList.add('correct');
            score++;
        } else {
            btnElement.classList.add('wrong');
            allBtns[q.correct].classList.add('correct'); // –ü–æ–∫–∞–∑–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –∫–Ω–æ–ø–∫—É "–î–∞–ª—å—à–µ" –∏–ª–∏ "–ó–∞–≤–µ—Ä—à–∏—Ç—å"
        if(currentQuestionIndex < activeQuiz.questions.length - 1) {
            document.getElementById('next-btn').classList.remove('hidden');
        } else {
            document.getElementById('finish-btn').classList.remove('hidden');
        }
        document.getElementById('score-display').innerText = `–°—á–µ—Ç: ${score}/${activeQuiz.questions.length}`;
    }

    function nextQuestion() {
        currentQuestionIndex++;
        renderQuestion();
    }

    function finishQuiz() {
        alert(`–¢–µ—Å—Ç –∑–∞–≤–µ—Ä—à–µ–Ω! –í–∞—à —Ä–µ–∑—É–ª—å—Ç–∞—Ç: ${score} –∏–∑ ${activeQuiz.questions.length}`);
        showMenu();
    }
</script>

</body>
</html>
